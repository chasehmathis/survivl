<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Survival Outcomes using Risk Functions • survivl</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Survival Outcomes using Risk Functions">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survivl</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Causal_Survival_Analysis.html">Causal Survival Analysis</a>
    </li>
    <li>
      <a href="../articles/Complicated-Copulas.html">Complicated Copulas</a>
    </li>
    <li>
      <a href="../articles/Examples.html">Examples</a>
    </li>
    <li>
      <a href="../articles/Longitudinal-Single-Outcome.html">Longitudinal Non-Survival Outcomes</a>
    </li>
    <li>
      <a href="../articles/MSMs.html">Marginal Structural Survival Models</a>
    </li>
    <li>
      <a href="../articles/Plasmode.html">Plasmode</a>
    </li>
    <li>
      <a href="../articles/Seaman-Keogh-Bivariate-Copula.html">Survival Outcomes using Risk Functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Survival Outcomes using Risk Functions</h1>
                        <h4 data-toc-skip class="author">Chase
Mathis</h4>
            
            <h4 data-toc-skip class="date">2025-08-06</h4>
      

      <div class="hidden name"><code>Seaman-Keogh-Bivariate-Copula.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="seaman-keoghs-bivariate-copula-framework">Seaman &amp; Keogh’s Bivariate Copula Framework<a class="anchor" aria-label="anchor" href="#seaman-keoghs-bivariate-copula-framework"></a>
</h2>
<p>In this vignette, we consider simulating longitudinal, survival data
using Seaman &amp; Keogh’s risk function method. For a refresher on the
basics of MSMs see the Marginal Structural Model vignettes.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">survivl</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span> <span class="co"># for coxph</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">124</span><span class="op">)</span></span></code></pre></div>
<p>We define our survival model the same as the modle in the Marginal
Structural Model Vignette. One thing that is different is that the
copula formula is just one list entry. This formula no longer specifies
the copula, but specifies the risk function necessary for the simulation
technique. Similarly, the copula parameters only have a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
entry as we only have one parameter.</p>
<p>There are two ways Seaman &amp; Keogh allow users to model the causal
effect in a survival marginal structural model. The first method is to
directly model the probability risk function <span class="math inline">$P(Y_k \mid \rm{do}(\bar{A_k}), Y_{k-1} =
0)$</span>. The second method is to model the hazard through a more
flexible model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda(t)</annotation></semantics></math>.
The package supports both and we will first describe how to directly
model hazards.</p>
<div class="section level3">
<h3 id="directly-modeling-hazards">Directly Modeling Hazards<a class="anchor" aria-label="anchor" href="#directly-modeling-hazards"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">W</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>              <span class="va">Z</span> <span class="op">~</span> <span class="va">Z_l1</span> <span class="op">+</span> <span class="va">X_l1</span>,</span>
<span>              <span class="va">X</span> <span class="op">~</span> <span class="va">X_l1</span> <span class="op">+</span> <span class="va">Z_l0</span>,</span>
<span>              <span class="va">Y</span> <span class="op">~</span> <span class="va">W</span> <span class="op">+</span> <span class="va">X_l0</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z_l0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fl">0</span>, phi<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>             Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.7</span>,<span class="fl">0.2</span><span class="op">)</span>, phi<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>             X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>,<span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>, phi<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>             cop <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rho <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"log"</span>, <span class="st">"identity"</span>, <span class="st">"logit"</span>, <span class="st">"logit"</span><span class="op">)</span></span></code></pre></div>
<p>Note that we put the family for our outcome to be binomial. A
binomial distribution is not a survival distribution like exponential or
weibull. If the user specifies a binomial family in <code>survivl</code>
the computer understands that the user wants to directly model the risk.
To keep numbers in a [0,1] scale, we use the logit link function.</p>
<p>Below, note that we add the <code>method</code> = “bootstrap”
argument to calculate. Also, the default number of simulations is 5e3
-1, but for this simulation we will do less at 2.5e2 for sake of
time.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/survivl_model.html">survivl_model</a></span><span class="op">(</span>formulas<span class="op">=</span><span class="va">forms</span>, family<span class="op">=</span><span class="va">fams</span>,</span>
<span>                    pars<span class="op">=</span><span class="va">pars</span>, T <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                    link <span class="op">=</span> <span class="va">link</span>, method <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>                    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bootsims <span class="op">=</span> <span class="fl">2.5e2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 13</span></span></code></pre>
<p>We can now simulate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><msup><mn>10</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">n=10^4</annotation></semantics></math>
observations from the model over 10 time points. You can see the
bootstrap simulations printing out. We note this method takes a bit
longer than the h-function methods.</p>
<div class="section level4">
<h4 id="estimating-the-causal-effect">Estimating the Causal Effect<a class="anchor" aria-label="anchor" href="#estimating-the-causal-effect"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">ipw</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ipw/man/ipwtm.html" class="external-link">ipwtm</a></span><span class="op">(</span></span>
<span>  exposure <span class="op">=</span> <span class="va">X</span>, </span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"logit"</span>,</span>
<span>  numerator <span class="op">=</span> <span class="op">~</span> <span class="va">W</span>,</span>
<span>  denominator <span class="op">=</span> <span class="op">~</span><span class="va">Z</span>,</span>
<span>  id <span class="op">=</span> <span class="va">id</span>,</span>
<span>  timevar <span class="op">=</span> <span class="va">t</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">datl</span></span>
<span><span class="op">)</span></span>
<span><span class="va">datl</span><span class="op">$</span><span class="va">wt</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">ipw.weights</span></span></code></pre></div>
<p>We recover the causal effect by using the IPW estimator (within 2
s.e.). If we had not use the weights, then our estimate would be very
far from the truth we had specified showing the strength of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
variable confounding on the effect of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">W</span> <span class="op">+</span> <span class="va">X</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">datl</span>,</span>
<span>                    weights <span class="op">=</span> <span class="va">wt</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mod_incorrect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">W</span> <span class="op">+</span> <span class="va">X</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">datl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fix: use correct model object names and ensure proper table formatting</span></span>
<span></span>
<span><span class="co"># Compute table for correct (weighted) model</span></span>
<span><span class="va">tab_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="st">"Truth"</span> <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"Est."</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod_correct</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"Std. Err."</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_correct</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="st">"Std. Error"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute table for naive (unweighted) model</span></span>
<span><span class="va">tab_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="st">"Truth"</span> <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"Est."</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod_incorrect</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"Std. Err."</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_incorrect</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="st">"Std. Error"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span><span class="va">tab_naive</span>, digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span>, booktabs<span class="op">=</span><span class="cn">TRUE</span>, format<span class="op">=</span><span class="st">"latex"</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html" class="external-link">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"Naive Model"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span><span class="va">tab_correct</span>, digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span>, booktabs<span class="op">=</span><span class="cn">TRUE</span>, format<span class="op">=</span><span class="st">"latex"</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html" class="external-link">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"IPW Model"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="continuous-time-failures">Continuous Time Failures<a class="anchor" aria-label="anchor" href="#continuous-time-failures"></a>
</h3>
<p>Above, we directly modeled the hazard of a single observation and do
not model when an observation may fail but instead how likely it is to
make it to the next time step. If we want to model time continuously, we
can use the exponential or weibull distribution.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fams2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">link2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"log"</span>, <span class="st">"identity"</span>, <span class="st">"logit"</span>, <span class="st">"log"</span><span class="op">)</span></span>
<span><span class="va">pars2</span> <span class="op">&lt;-</span> <span class="va">pars</span>;</span>
<span><span class="va">pars2</span><span class="op">[[</span><span class="st">"Y"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">-</span><span class="fl">0.45</span>, <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span>, phi<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sm2</span> <span class="op">&lt;-</span> <span class="fu">modify</span><span class="op">(</span><span class="va">sm</span>, family <span class="op">=</span> <span class="va">fams2</span>, pars <span class="op">=</span> <span class="va">pars2</span><span class="op">)</span></span></code></pre></div>
<p>Now, we model the outcome to be exponential (Gamma family is 3) and
phi = 1 is exponential. We use the modify function to modify our
survival model object. For fun, we also change the paramaters of <span class="math inline">$Y \mid \rm{do}(X)$</span> The rest of the data
generation is the same as above.</p>
<div class="section level4">
<h4 id="estimating-the-causal-effect-1">Estimating the Causal Effect<a class="anchor" aria-label="anchor" href="#estimating-the-causal-effect-1"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">ipw</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ipw/man/ipwtm.html" class="external-link">ipwtm</a></span><span class="op">(</span></span>
<span>  exposure <span class="op">=</span> <span class="va">X</span>, </span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"logit"</span>,</span>
<span>  numerator <span class="op">=</span> <span class="op">~</span> <span class="va">W</span>,</span>
<span>  denominator <span class="op">=</span> <span class="op">~</span>  <span class="va">Z</span>,</span>
<span>  id <span class="op">=</span> <span class="va">id</span>,</span>
<span>  timevar <span class="op">=</span> <span class="va">t</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">datl</span></span>
<span><span class="op">)</span></span>
<span><span class="va">datl</span><span class="op">$</span><span class="va">wt</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">ipw.weights</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">t_stop</span>, <span class="va">Y</span><span class="op">)</span> <span class="op">~</span> <span class="va">W</span> <span class="op">+</span> <span class="va">X</span>, </span>
<span>                        dist <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">datl</span>,</span>
<span>                        weights <span class="op">=</span> <span class="va">wt</span><span class="op">)</span></span>
<span><span class="va">mod_incorrect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">t_stop</span>, <span class="va">Y</span><span class="op">)</span> <span class="op">~</span> <span class="va">W</span> <span class="op">+</span> <span class="va">X</span>, </span>
<span>                        dist <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">datl</span>,</span>
<span>                        weights <span class="op">=</span> <span class="va">wt</span><span class="op">)</span>               </span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="st">"Truth"</span> <span class="op">=</span> <span class="va">pars2</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"Est."</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod_correct</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"Std. Err."</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_correct</span><span class="op">)</span><span class="op">$</span><span class="va">table</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="st">"Std. Error"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute table for naive (unweighted) model</span></span>
<span><span class="va">tab_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="st">"Truth"</span> <span class="op">=</span> <span class="va">pars2</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"Est."</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod_incorrect</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"Std. Err."</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_incorrect</span><span class="op">)</span><span class="op">$</span><span class="va">table</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="st">"Std. Error"</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span><span class="va">tab_naive</span>, digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span>, booktabs<span class="op">=</span><span class="cn">TRUE</span>, format<span class="op">=</span><span class="st">"latex"</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html" class="external-link">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"Naive Model"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span><span class="va">tab_correct</span>, digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span>, booktabs<span class="op">=</span><span class="cn">TRUE</span>, format<span class="op">=</span><span class="st">"latex"</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html" class="external-link">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"IPW Model"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robin Evans.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
