<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Longitudinal Non-Survival Outcomes • survivl</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Longitudinal Non-Survival Outcomes">
<meta property="og:description" content="survivl">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survivl</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Causal_Survival_Analysis.html">Causal Survival Analysis</a>
    </li>
    <li>
      <a href="../articles/Examples.html">Examples</a>
    </li>
    <li>
      <a href="../articles/Longitudinal-Outcome.html">Longitudinal Non-Survival Outcomes</a>
    </li>
    <li>
      <a href="../articles/MSMs.html">Marginal Structural Survival Models</a>
    </li>
    <li>
      <a href="../articles/Plasmode.html">Plasmode</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Longitudinal Non-Survival Outcomes</h1>
                        <h4 data-toc-skip class="author">Chase
Mathis</h4>
            
            <h4 data-toc-skip class="date">2025-07-17</h4>
      
      
      <div class="hidden name"><code>Longitudinal-Outcome.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="marginal-structural-models">Marginal Structural Models<a class="anchor" aria-label="anchor" href="#marginal-structural-models"></a>
</h2>
<p>In this vignette we consider <em>marginal structural models</em> for
<em>non</em>-time-to-event data. Begin by loading the library.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">survivl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>We follow the situation as researched in Bodnar et al. (2004), which
examines the causal effect of iron supplement use during pregancy on the
odds of anemia at delivery. Therefore, we have a longitudinal data
structure with one, non survival outcome. We have time varying
covariates as treatment is not fixed and hemoglobin levels dictate
further treatment assignments.</p>
<p>The baseline covariates are <span class="math inline">\(Z\)</span>
which is the set {B = pre-pregnancy obesity, C = age}. <span class="math inline">\(L\)</span> is our single time varying covariate:
Hemoglobin levels. The outcome <span class="math inline">\(Y\)</span> is
a binary {0,1} indicating anemia at delivery.</p>
<p>We set at <span class="math inline">\(t = 0\)</span>, <span class="math inline">\(B \sim \rm{Bernoulli}(0.1), C \sim U(25, 35), L_0
\sim N(11−0.05 B−0.02 C, 0.5)\)</span> and <span class="math inline">\(A_0 \sim \rm{Bernoulli}(0.5)\)</span>.</p>
<p>For <span class="math inline">\(k &gt; 0\)</span>, we have <span class="math inline">\(L_k \sim N(L_{k−1} + 0.5 A_{k−1}, 0.1)\)</span>,
<span class="math inline">\(A_0 = A_1 = A_2\)</span> and <span class="math inline">\(A_k \sim \rm{Bernoulli}(\rm{expit}(10 - L_k +
0.1A_{k-1})\)</span> for <span class="math inline">\(k =
3,4\)</span>.</p>
<p>Our structural causal model is</p>
<p><span class="math display">\[\PM(Y = 1 \mid \rm{do}(\bar{A_k}, B, C)
= \rm{expit}(-2 + 0.1B + 0.02C - \beta \sum_{j =
1}^{4}A_j))\]</span></p>
<div class="section level3">
<h3 id="simulate-t-0-1-2">Simulate t = 0, 1, 2<a class="anchor" aria-label="anchor" href="#simulate-t-0-1-2"></a>
</h3>
<p>Here, we set up the number of samples and our quantiles data frame.
Note that we assume <span class="math inline">\(A_k\)</span> is the same
for <span class="math inline">\(k = 0,1,2\)</span>, so the quantiles for
those variables are set to be the same.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># t = 0, n = 10,000</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e4</span></span>
<span><span class="va">qtls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="fl">4</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">qtls</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"L_0"</span>, <span class="st">"A_0"</span><span class="op">)</span></span>
<span><span class="va">qtls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">qtls</span>, <span class="va">qtls</span><span class="op">[[</span><span class="st">"A_0"</span><span class="op">]</span><span class="op">]</span>, <span class="va">qtls</span><span class="op">[[</span><span class="st">"A_0"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">qtls</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"L_0"</span>, <span class="st">"A_0"</span>, <span class="st">"A_1"</span>, <span class="st">"A_2"</span><span class="op">)</span></span></code></pre></div>
<p>Now we use the inverse cdf to get random samples from our quantiles.
We collect them in <code>dat0</code> variable.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">qbinom</a></span><span class="op">(</span><span class="va">qtls</span><span class="op">[[</span><span class="st">"B"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>;  <span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">qunif</a></span><span class="op">(</span><span class="va">qtls</span><span class="op">[[</span><span class="st">"C"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">25</span>, <span class="fl">35</span><span class="op">)</span></span>
<span><span class="va">L_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">qtls</span><span class="op">[[</span><span class="st">"L_0"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">11</span> <span class="op">-</span> <span class="fl">0.05</span> <span class="op">*</span> <span class="va">B</span> <span class="op">-</span> <span class="fl">0.02</span> <span class="op">*</span> <span class="va">C</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">A_0</span> <span class="op">&lt;-</span> <span class="va">A_1</span> <span class="op">&lt;-</span> <span class="va">A_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">qbinom</a></span><span class="op">(</span><span class="va">qtls</span><span class="op">[[</span><span class="st">"A_0"</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">B</span>, <span class="va">C</span>, <span class="va">L_0</span>, <span class="va">A_0</span>, <span class="va">A_1</span>, <span class="va">A_2</span><span class="op">)</span></span></code></pre></div>
<p>This code chunk sets up our <code>surv_model</code> object by
defining the structur and parameters we imposed above.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">B</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">C</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>              <span class="va">L</span> <span class="op">~</span> <span class="va">B</span> <span class="op">+</span> <span class="va">C</span>,</span>
<span>              <span class="va">A</span> <span class="op">~</span> <span class="va">L_l0</span> <span class="op">+</span> <span class="va">A_l1</span>,</span>
<span>              <span class="va">Y</span> <span class="op">~</span> <span class="va">B</span> <span class="op">+</span> <span class="va">C</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">A_0</span> <span class="op">+</span> <span class="va">A_1</span> <span class="op">+</span> <span class="va">A_2</span> <span class="op">+</span> <span class="va">A_3</span> <span class="op">+</span> <span class="va">A_4</span><span class="op">)</span>,</span>
<span>              <span class="va">L</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>             <span class="fl">1</span>,</span>
<span>             <span class="fl">5</span>,</span>
<span>             <span class="fl">5</span>,</span>
<span>             <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">causal_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0.1</span>, <span class="fl">0.02</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="op">-</span><span class="fl">0.05</span>, <span class="op">-</span><span class="fl">0.02</span><span class="op">)</span>, phi <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="va">causal_parameters</span><span class="op">)</span>,</span>
<span>  cop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0.4</span>, par2 <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surv_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/survivl_model.html">survivl_model</a></span><span class="op">(</span>formulas <span class="op">=</span> <span class="va">forms</span>, family <span class="op">=</span> <span class="va">fams</span>,</span>
<span>                            pars <span class="op">=</span> <span class="va">pars</span>, T <span class="op">=</span> <span class="fl">5</span>, dat <span class="op">=</span> <span class="va">dat0</span>, qtls <span class="op">=</span> <span class="va">qtls</span><span class="op">)</span></span></code></pre></div>
<p>We call <code>rmsm</code> to simulate from this model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">rmsm</span><span class="op">(</span><span class="va">n</span>, <span class="va">surv_model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'copula' was built under R version 4.3.3</span></span></code></pre>
<p>Now, we choose to use the IPW estimator to recover our estimates we
specified.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_A0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">A_0</span> <span class="op">~</span> <span class="va">L_0</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">glm_A3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">A_3</span> <span class="op">~</span> <span class="va">L_0</span> <span class="op">+</span> <span class="va">L_1</span> <span class="op">+</span> <span class="va">L_2</span> <span class="op">+</span> <span class="va">A_0</span> , family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">glm_A4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">A_4</span> <span class="op">~</span> <span class="va">L_0</span> <span class="op">+</span> <span class="va">L_1</span> <span class="op">+</span> <span class="va">L_2</span> <span class="op">+</span> <span class="va">L_3</span> <span class="op">+</span> <span class="va">A_0</span>  <span class="op">+</span> <span class="va">A_3</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_A0_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">A_0</span> <span class="op">~</span> <span class="fl">1</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">glm_A3_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">A_3</span> <span class="op">~</span> <span class="va">A_0</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">glm_A4_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">A_4</span> <span class="op">~</span> <span class="va">A_0</span> <span class="op">+</span> <span class="va">A_3</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps_A0_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">glm_A0_num</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">ps_A3_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">glm_A3_num</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">ps_A4_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">glm_A4_num</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps_A0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">glm_A0</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">ps_A3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">glm_A3</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">ps_A4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">glm_A4</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute weights depending on actual values of X_t</span></span>
<span><span class="va">w0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">A_0</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">ps_A0</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">ps_A0</span><span class="op">)</span></span>
<span><span class="va">w1</span> <span class="op">&lt;-</span> <span class="va">w2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span><span class="op">)</span> <span class="co">#  always 1 because A_1 and A_2 are deterministic conditional on A_0</span></span>
<span><span class="va">w3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">A_3</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">ps_A3</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">ps_A3</span><span class="op">)</span></span>
<span><span class="va">w4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">A_4</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">ps_A4</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">ps_A4</span><span class="op">)</span></span>
<span><span class="va">w0_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">A_0</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">ps_A0_num</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">ps_A0_num</span><span class="op">)</span></span>
<span><span class="va">w3_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">A_3</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">ps_A3_num</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">ps_A3_num</span><span class="op">)</span></span>
<span><span class="va">w4_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">A_4</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">ps_A4_num</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">ps_A4_num</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">iptw_weights</span> <span class="op">&lt;-</span> <span class="va">w0_num</span> <span class="op">*</span> <span class="va">w3_num</span> <span class="op">*</span> <span class="va">w4_num</span> <span class="op">/</span> <span class="op">(</span><span class="va">w0</span> <span class="op">*</span> <span class="va">w1</span> <span class="op">*</span> <span class="va">w2</span> <span class="op">*</span> <span class="va">w3</span> <span class="op">*</span> <span class="va">w4</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">glm_Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">B</span> <span class="op">+</span> <span class="va">C</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">A_0</span> <span class="op">+</span> <span class="va">A_1</span> <span class="op">+</span> <span class="va">A_2</span> <span class="op">+</span> <span class="va">A_3</span> <span class="op">+</span> <span class="va">A_4</span><span class="op">)</span>, </span>
<span>             data <span class="op">=</span> <span class="va">dat</span>, weights <span class="op">=</span> <span class="va">iptw_weights</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in eval(family$initialize): non-integer #successes in a binomial glm!</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sumY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glm_Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">sumY</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">causal_parameters</span><span class="op">)</span><span class="op">/</span><span class="va">sumY</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                    (Intercept)                              B </span></span>
<span><span class="co">##                         0.2088                         0.7420 </span></span>
<span><span class="co">##                              C I(A_0 + A_1 + A_2 + A_3 + A_4) </span></span>
<span><span class="co">##                         0.2591                         0.4894</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># should be less than 2 se 95% of the time</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robin Evans.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
